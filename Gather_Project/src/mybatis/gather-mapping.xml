<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="my.gather-mapping">

	<!-- 팀 리스트 불러오기 -->
	<select id="getListTeam" parameterType="java.lang.Integer" resultType="TeamDTO">
		<![CDATA[
			SELECT ROWNUM rn, A.*
			FROM(SELECT M_IDX AS MIDX, MY_T.T_IDX AS TIDX, T_NAME AS TNAME
			FROM MY_T, TEAM WHERE MY_T.T_IDX=TEAM.T_IDX AND M_IDX=#{mIdx}
			ORDER BY TIDX DESC
			) A
		]]>
	</select>

	<!-- 마지막에 수정했던 팀의 tIdx와 tName 가져오기 -->
	<select id="getSelectTeam" parameterType="java.lang.Integer" resultType="TeamDTO">
		<![CDATA[
			SELECT T_IDX as tIdx, T_NAME as tName
			FROM TEAM WHERE T_IDX=(SELECT T_IDX FROM L_TEAM WHERE M_IDX=#{mIdx})
		]]>
	</select>

	<!-- 소속된 팀 맴버의 이름 가져오기 -->
	<select id="getTeamMember" parameterType="java.lang.Integer" resultType="java.lang.String">
		<![CDATA[
			SELECT NAME FROM MY_T,MEMBER 
			WHERE MY_T.M_IDX=MEMBER.M_IDX AND T_IDX=#{lastTIdx}
		]]>
	</select>

	<!-- 소속된 팀 맴버의 이름 가져오기 -->
	<select id="getCallMember" parameterType="java.lang.Integer" resultType="java.lang.String">
		<![CDATA[
			SELECT NAME 
			FROM MEMBER, CALL 
			WHERE MEMBER.M_IDX = CALL.M_IDX AND T_IDX=#{tIdx}
		]]>
	</select>

	<!-- 팀 기획 정보(기획 번호, 기획 주제) -->
	<select id="getDesign" parameterType="java.lang.Integer" resultType="DesignDTOR">
		<![CDATA[
			SELECT D_IDX AS DIDX, D_NAME AS DNAME FROM DESIGN WHERE T_IDX=#{tIdx}
		]]>
	</select>
	<select id="getdesignPurpose" parameterType="java.lang.Integer" resultType="java.lang.String">
		<![CDATA[
			SELECT D_PURP FROM D_PURP WHERE D_IDX=#{dIdx}
		]]>
	</select>
	<select id="getdesignContent" parameterType="java.lang.Integer" resultType="java.lang.String">
		<![CDATA[
			SELECT D_CON FROM D_CON WHERE D_IDX=#{dIdx}
		]]>
	</select>
	<select id="getWorkList" parameterType="java.lang.Integer" resultType="WorkDTO">
		<![CDATA[
			SELECT 
			W_IDX AS WIDX, WORK, W_PROC AS WPROC, TO_CHAR(W_SDATE, 'yyyy-mm-dd' )AS WSDATE,
			TO_CHAR(W_EDATE, 'yyyy-mm-dd' )AS WEDATE, W_MEM AS WMEM, T_IDX AS TIDX 
			FROM WORK WHERE T_IDX=#{tIdx}
			ORDER BY WPROC DESC
		]]>
	</select>
	<select id="LastTeam" parameterType="HashMap">
		<![CDATA[		
			UPDATE L_TEAM SET T_IDX=#{tIdx} WHERE M_IDX=#{mIdx} 
		]]>
	</select>
	<insert id="creLastTeam" parameterType="HashMap">
		<![CDATA[		
			insert into L_TEAM values(#{mIdx}, #{tIdx})
		]]>
	</insert>
	<select id="callConfrim" parameterType="java.lang.Integer" resultType="TeamDTO">
		<![CDATA[		
			SELECT TEAM.T_IDX as tIdx, T_NAME as tName FROM TEAM,CALL 
			WHERE TEAM.T_IDX = CALL.T_IDX AND M_IDX=#{mIdx}
			GROUP BY TEAM.T_IDX,T_NAME
		]]>
	</select>
	<delete id="LastTeamDel" parameterType="java.lang.Integer">
		<![CDATA[		
			delete L_TEAM where m_IDX=#{mIdx}
		]]>
	</delete>
</mapper>